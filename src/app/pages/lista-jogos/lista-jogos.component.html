<div class="main-content">
  <div class="d-flex justify-content-center" style="vertical-align:middle;">
    <div class="spinner-border text-danger" *ngIf="loading" styrole="status">
      <span class="sr-only"></span>
    </div>
  </div>

  <div class="container-fluid" *ngIf="!loading">
    <!-- Filtros Section -->
    <div *ngIf="hasEquipaB" class="modern-card shadow mb-4">
      <div class="card-body-modern">
        <div class="d-flex justify-content-center">
          <mat-button-toggle-group (change)="filtrarEquipas()" [(ngModel)]="filtro" class="filter-group">
            <mat-button-toggle value="todos" class="filter-btn">Todos</mat-button-toggle>
            <mat-button-toggle value="equipa_a" class="filter-btn">Equipa A</mat-button-toggle>
            <mat-button-toggle value="equipa_b" class="filter-btn">Equipa B</mat-button-toggle>
          </mat-button-toggle-group>
        </div>
      </div>
    </div>

    <!-- Jogos Section -->
    <div *ngIf="jogos.length > 0">
      <div class="jogos-list">
        <div *ngFor="let jogo of jogos" class="jogo-row-modern"
             [class.jogo-registado]="jogo.estado === 'REGISTADO'"
             (click)="(jogo.estado === 'CONCLUIDO' || jogo.estado === 'INICIADO') && verJogo(jogo.id)">

          <div class="jogo-row-content">
            <div class="jogo-date-mobile">
              <div class="date-main">{{ jogo.data | date:'dd/MM' }}</div>
              <small class="text-muted d-none d-md-inline">{{ jogo.data | date:'yyyy' }}</small>
            </div>

            <div class="jogo-opponent-mobile">
              <div class="opponent-logo-container">
                <img src="assets/img/clubes/clube_{{ jogo.equipa_adv_id }}.png"
                     onerror="this.onerror=null; this.src='assets/img/clubes/default_clube.png'"
                     class="opponent-logo-mobile" />
                <span class="local-indicator">{{ jogo.tipo_local === 'C' ? 'C' : 'F' }}</span>
              </div>
              <div class="opponent-info-mobile">
                <span class="opponent-name-mobile">{{ jogo.equipa_adv_nome }}<span *ngIf="jogo.tipoEquipa_adv==='B'" class="equipa-b-badge-mobile"> B</span></span>
              </div>
            </div>

            <div class="jogo-result-mobile">
              <span *ngIf="jogo.estado === 'CONCLUIDO' && jogo.tipo_local==='C'" [ngClass]="{
                'result-win-mobile': jogo.golos_equipa_adv < jogo.golos_equipa,
                'result-loss-mobile': jogo.golos_equipa_adv > jogo.golos_equipa,
                'result-draw-mobile': jogo.golos_equipa_adv === jogo.golos_equipa
              }">{{jogo.golos_equipa}} - {{jogo.golos_equipa_adv}}</span>
              <span *ngIf="jogo.estado === 'CONCLUIDO' && jogo.tipo_local==='F'" [ngClass]="{
                'result-win-mobile': jogo.golos_equipa_adv < jogo.golos_equipa,
                'result-loss-mobile': jogo.golos_equipa_adv > jogo.golos_equipa,
                'result-draw-mobile': jogo.golos_equipa_adv === jogo.golos_equipa
              }">{{jogo.golos_equipa_adv}} - {{jogo.golos_equipa}}</span>
              <span *ngIf="jogo.estado !== 'CONCLUIDO'" class="text-muted small"></span>
            </div>

            <div class="jogo-competition-mobile">
              <img src="assets/img/competicoes/c_{{ jogo.competicao_id }}.png"
                   onerror="this.onerror=null; this.src='assets/img/competicoes/default_competicao.png'"
                   class="competition-logo-mobile" />
            </div>

            <div class="jogo-actions-mobile">
              <div ngbDropdown class="d-inline-block" (click)="$event.stopPropagation()">
                <button class="btn-action-mobile" ngbDropdownToggle>
                  <i class="nc-icon nc-settings-gear-65"></i>
                </button>

                <div ngbDropdownMenu class="dropdown-menu-modern">
                  <button *ngIf="jogo.estado === 'REGISTADO'" ngbDropdownItem (click)="verConvocatoria(jogo.id)">
                    <i class="nc-icon nc-bullet-list-67 me-2"></i>Convocatória
                  </button>

                  <button *ngIf="jogo.estado !== 'REGISTADO'" ngbDropdownItem (click)="verJogo(jogo.id)">
                    <i class="nc-icon nc-zoom-split me-2"></i>Ver Jogo
                  </button>

                  <button ngbDropdownItem (click)="editarJogo(jogo, content)">
                    <i class="nc-icon nc-ruler-pencil me-2"></i>Editar
                  </button>

                  <button ngbDropdownItem (click)="apagarJogo(jogo)">
                    <i class="nc-icon nc-simple-remove me-2 text-danger"></i>Apagar
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="jogos.length === 0" class="empty-state-modern">
      <div class="empty-icon">
        <i class="nc-icon nc-trophy"></i>
      </div>
      <h5>Nenhum jogo encontrado</h5>
      <p class="text-muted">Clique em "Adicionar Novo Jogo" para começar a adicionar jogos.</p>
    </div>

    <!-- Add Game Button -->
    <div class="text-center mt-4">
      <button class="btn-add-modern" (click)="adicionarJjogo(content)">
        <i class="nc-icon nc-simple-add me-2"></i>Adicionar Novo Jogo
      </button>
    </div>
  </div>

<!-- Modal para Adicionar Novo Jogo (Transformado Visualmente - Estilo Ficha Atleta) -->
<ng-template #content let-modal>
  <div class="modal-header bg-light border-bottom">
    <h4 *ngIf="!isModoEditar" class="modal-title mb-0" id="modal-basic-title">
      <i class="nc-icon nc-trophy text-primary me-2"></i>Adicionar Novo Jogo
    </h4>
    <h4 *ngIf="isModoEditar" class="modal-title mb-0" id="modal-basic-title">
      <i class="nc-icon nc-trophy text-primary me-2"></i>Editar Jogo
    </h4>
  </div>


  <!-- Seção 1: Equipa Clube -->
  <div class="modal-body p-4">
    <div class="card border-0 shadow-sm mb-4">
      <div class="card-header bg-success text-white">
        <h6 class="mb-0"><i class="nc-icon nc-single-02 me-2"></i>Equipa Clube</h6>
      </div>
      <div class="card-body">
        <form>
          <!-- Tipo Equipa Adv -->
          <div class="col-md-6 mb-3">
            <div class="form-check mt-2"> <!-- form-check para estrutura Bootstrap -->
              <section class="example-section">
                <mat-checkbox [(ngModel)]="isEquipaB_local">Equipa B</mat-checkbox>
              </section>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>


  <!-- Seção 2: Adversário e Competição (Em Grid, Similar a Seções de Atleta) -->
  <div class="modal-body p-4">
    <div class="card border-0 shadow-sm mb-4">
      <div class="card-header bg-success text-white">
        <h6 class="mb-0"><i class="nc-icon nc-single-02 me-2"></i>Adversário e Competição</h6>
      </div>
      <div class="card-body">
        <form>
          <div class="row">
            <!-- Equipa Adversária -->
            <div class="col-md-6 mb-3">
              <label for="equipaAdversaria" class="form-label fw-bold">
                <i class="nc-icon nc_users-1 me-1 text-success"></i>Equipa Adversária <span class="text-danger">*</span>
              </label>
              <select class="form-select form-select" id="equipaAdversaria" [(ngModel)]="novoJogo.equipa_adv_id"
                name="equipaAdversaria" (change)="onEquipaAdversariaChange(novoJogo.equipa_adv_id)" required>
                <option [ngValue]="0" disabled selected>Selecione uma equipa</option>
                <option *ngFor="let clube of clubes" [ngValue]="clube.id">
                  {{ clube.nome }}
                </option>
              </select>
            </div>

            <!-- Tipo Equipa Adv -->
            <div class="col-md-6 mb-3">
              <div class="form-check mt-2"> <!-- form-check para estrutura Bootstrap -->
                <section class="example-section">
                  <mat-checkbox [(ngModel)]="isEquipaB_adv">Equipa B</mat-checkbox>
                </section>
              </div>
            </div>
          </div>

          <div class="row">
            <!-- Competição -->
            <div class="col-md-12 mb-3">
              <label for="competicao" class="form-label fw-bold">
                <i class="nc-icon nc-trophy me-1 text-success"></i>Competição <span class="text-danger">*</span>
              </label>
              <select class="form-select form-select" id="competicao" [(ngModel)]="novoJogo.competicao_id"
                name="competicao" (change)="onCompeticaoChange(novoJogo.competicao_id)" required>
                <option [ngValue]="0" disabled selected>Selecione uma competição</option>
                <option *ngFor="let comp of competicoes" [ngValue]="comp.id">{{ comp.nome }}</option>
              </select>
            </div>
          </div>

          <!-- Campo adicional para competição outro -->
          <div class="row" *ngIf="novoJogo.competicao_id === 4">
            <div class="col-md-12 mb-3">
              <label for="competicaoOutro" class="form-label fw-bold">
                <i class="nc-icon nc-pencil me-1 text-success"></i>Descrição da Competição Outro <span class="text-danger">*</span>
              </label>
              <input type="text" class="form-control form-control" id="competicaoOutro" [(ngModel)]="novoJogo.competicao_outro_descritivo"
                name="competicaoOutro" placeholder="Descreva a competição" required>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
  <div class="modal-body p-4">
    <!-- Seção 1: Detalhes Básicos do Jogo (Em Grid de 2 Colunas, como em Ficha Atleta) -->
    <div class="card border-0 shadow-sm mb-4">
      <div class="card-header bg-primary text-white">
        <h6 class="mb-0"><i class="nc-icon nc-calendar-60 me-2"></i>Detalhes do Jogo</h6>
      </div>
      <div class="card-body">
        <form>
          <div class="row">
            <!-- Coluna Esquerda -->
            <div class="col-md-6 mb-3">
              <label for="dataJogo" class="form-label fw-bold">
                <i class="nc-icon nc-calendar-60 text-primary me-1"></i>Data do Jogo <span class="text-danger">*</span>
              </label>
              <input type="date" class="form-control form-control" id="dataJogo" [(ngModel)]="novoJogo.data"
                name="dataJogo" required [class.is-invalid]="novoJogo.data === null">
              <div class="invalid-feedback">Data é obrigatória.</div>
            </div>

            <!-- Coluna Direita -->
            <div class="col-md-6 mb-3">
              <label for="horaJogo" class="form-label fw-bold">
                <i class="nc-icon nc-time-alarm me-1 text-primary"></i>Hora do Jogo <span class="text-danger">*</span>
              </label>
              <input type="time" class="form-control form-control" id="horaJogo" [(ngModel)]="novoJogo.hora"
                name="horaJogo" required [class.is-invalid]="novoJogo.hora === ''">
              <div class="invalid-feedback">Hora é obrigatória.</div>
            </div>
          </div>

          <div class="row">
            <!-- Tipo Local -->
            <div class="col-md-6 mb-3">
              <label for="tipoLocal" class="form-label fw-bold">
                <i class="nc-icon nc-home-50 me-1 text-primary"></i>Tipo de Local
              </label>
              <select class="form-select form-select" id="tipoLocal" [(ngModel)]="novoJogo.tipo_local" name="tipoLocal"
                (change)="onTipoLocal()">
                <option value="Casa">Casa</option>
                <option value="Fora">Fora</option>
              </select>
            </div>
            <!-- Coluna Direita -->
            <div class="col-md-6 mb-3">
              <label for="numerJogo" class="form-label fw-bold">
                Nº Jogo Oficial<span class="text-danger"></span>
              </label>
              <input type="text" class="form-control form-control" id="numeroJogo" [(ngModel)]="novoJogo.numeroJogo"
                name="numeroJogo">

            </div>
          </div>

          <div class="row">
            <!-- Local -->
            <div class="col-md-12 mb-3">
              <label for="localJogo" class="form-label fw-bold">
                <i class="nc-icon nc-pin-3 me-1 text-primary"></i>Local do Jogo <span class="text-danger">*</span>
              </label>
              <input type="text" class="form-control form-control" id="localJogo" [(ngModel)]="novoJogo.local"
                name="localJogo" placeholder="Ex: Pavilhão Municipal de Bragança" required>
            </div>
          </div>


        </form>
      </div>
    </div>


  </div>

  <div class="modal-footer bg-light border-top">

    <button type="button" class="btn btn-primary btn" (click)="modal.close('save')">
      <i class="nc-icon nc-check-2 me-2"></i>Salvar Jogo
    </button>
    <button type="button" class="btn btn-secondary btn" (click)="modal.dismiss('cancel')">
      <i class="nc-icon nc-simple-remove me-2"></i>Cancelar
    </button>
  </div>
</ng-template>