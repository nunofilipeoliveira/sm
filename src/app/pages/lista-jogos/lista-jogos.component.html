<P>
<div class="container">
  <div *ngIf="loading" class="d-flex justify-content-center my-4">
    <div class="spinner-border text-primary" role="status">
      <span class="sr-only"></span>
    </div>
  </div>



  <! -- Mensagem para nenhum jogo encontrado -->
    <div *ngIf="!loading && jogos.length === 0" class="alert alert-info text-center" role="alert">
      Nenhum jogo encontrado. Clique em "Adicionar Novo Jogo" para começar a adicionar jogos.
    </div>

   <div  class="tabela-scroll" >
      <div  *ngIf="hasEquipaB  && !loading" class="d-flex justify-content-between align-items-center mb-3 mt-3">
            <mat-button-toggle-group  (change)="filtrarEquipas()" [(ngModel)]="filtro">
          <mat-button-toggle value="todos">Todos</mat-button-toggle>
          <mat-button-toggle value="equipa_a">Equipa A</mat-button-toggle>
          <mat-button-toggle value="equipa_b">Equipa B</mat-button-toggle>

        </mat-button-toggle-group>
      </div>
  <table
    class="table table-sm table-responsive table-hover project-list-table align-middle"
    *ngIf="!loading && jogos.length > 0"
  >
    <thead class="thead-light">
      <tr>
        <th>Data</th>
        <th style="text-align: center;">Local</th>
        <th >Equipa</th>
        <th >Resultado</th>
        <th></th>
        <th class="d-none d-md-table-cell">Competição</th>
        <th>Ação</th>
      </tr>
    </thead>
    <tbody>
      <tr
        *ngFor="let jogo of jogos"
        [class.jogo-registado]="jogo.estado === 'REGISTADO'"
        (click)="(jogo.estado === 'CONCLUIDO' || jogo.estado === 'INICIADO') && verJogo(jogo.id)"
      >
        <td>{{ jogo.data | date:'dd/MM' }}</td>
        <td style="text-align: center;">({{ jogo.tipo_local }})</td>
        <td class="nome-equipa pe-4">
          <img
            src="assets/img/clubes/clube_{{ jogo.equipa_adv_id }}.png"
            onerror="this.onerror=null; this.src='assets/img/clubes/default_clube.png'"
            class="team-logo"
          />
          {{ jogo.equipa_adv_nome }}
          <span *ngIf="jogo.tipoEquipa_adv==='B'">({{jogo.tipoEquipa_adv}})</span>
        </td>
        <td style="text-align: center;">
          <span
            *ngIf="jogo.estado === 'CONCLUIDO' && jogo.tipo_local==='C'"
            [ngClass]="{
              loss: jogo.golos_equipa_adv > jogo.golos_equipa,
              win: jogo.golos_equipa_adv < jogo.golos_equipa,
              draw: jogo.golos_equipa_adv === jogo.golos_equipa
            }"
            >{{jogo.golos_equipa}} - {{jogo.golos_equipa_adv}}</span
          >
          <span
            *ngIf="jogo.estado === 'CONCLUIDO' && jogo.tipo_local==='F'"
            [ngClass]="{
              loss: jogo.golos_equipa_adv > jogo.golos_equipa,
              win: jogo.golos_equipa_adv < jogo.golos_equipa,
              draw: jogo.golos_equipa_adv === jogo.golos_equipa
            }"
            >{{jogo.golos_equipa_adv}} - {{jogo.golos_equipa}}</span
          >
        </td>
        <td style="width: 12%; text-align: end;">
          <img
            src="assets/img/competicoes/c_{{ jogo.competicao_id }}.png"
            onerror="this.onerror=null; this.src='assets/img/competicoes/default_competicao.png'"
            class="flag-icon"
          />
        </td>
        <td class="d-none d-md-table-cell">{{ jogo.competicao_nome }}</td>
        <td>
          <div ngbDropdown class="d-inline-block" (click)="$event.stopPropagation()">
            <button class="btn btn-sm btn-secondary" ngbDropdownToggle>
              <i class="nc-icon nc-settings-gear-65"></i>
              <span class="d-none d-md-inline">Ações</span>
            </button>

            <div ngbDropdownMenu>
              <button
                *ngIf="jogo.estado === 'REGISTADO'"
                ngbDropdownItem
                (click)="verConvocatoria(jogo.id)"
              >
                <i class="nc-icon nc-bullet-list-67 me-2"></i>Convocatória
              </button>

              <button
                *ngIf="jogo.estado !== 'REGISTADO'"
                ngbDropdownItem
                (click)="verJogo(jogo.id)"
              >
                <i class="nc-icon nc-zoom-split me-2"></i>Ver Jogo
              </button>

              <button *ngIf="isAdmin" ngbDropdownItem (click)="editarJogo(jogo, content)">
                <i class="nc-icon nc-ruler-pencil me-2"></i>Editar
              </button>

              <button *ngIf="isAdmin" ngbDropdownItem (click)="apagarJogo(jogo)">
                <i class="nc-icon nc-simple-remove me-2 text-danger"></i>Apagar
              </button>
            </div>
          </div>
        </td>
      </tr>
    </tbody>
  </table>
</div>


    <div class="text-center mt-3">
      <button class="btn btn-primary" (click)="adicionarJjogo(content)">
        <b>+</b> Adicionar Novo Jogo
      </button>
    </div>
</div>

<!-- Modal para Adicionar Novo Jogo (Transformado Visualmente - Estilo Ficha Atleta) -->
<ng-template #content let-modal>
  <div class="modal-header bg-light border-bottom">
    <h4 *ngIf="!isModoEditar" class="modal-title mb-0" id="modal-basic-title">
      <i class="nc-icon nc-trophy text-primary me-2"></i>Adicionar Novo Jogo
    </h4>
    <h4 *ngIf="isModoEditar" class="modal-title mb-0" id="modal-basic-title">
      <i class="nc-icon nc-trophy text-primary me-2"></i>Editar Jogo
    </h4>
  </div>


  <!-- Seção 1: Equipa Clube -->
  <div class="modal-body p-4">
    <div class="card border-0 shadow-sm mb-4">
      <div class="card-header bg-success text-white">
        <h6 class="mb-0"><i class="nc-icon nc-single-02 me-2"></i>Equipa Clube</h6>
      </div>
      <div class="card-body">
        <form>
          <!-- Tipo Equipa Adv -->
          <div class="col-md-6 mb-3">
            <div class="form-check mt-2"> <!-- form-check para estrutura Bootstrap -->
              <section class="example-section">
                <mat-checkbox [(ngModel)]="isEquipaB_local">Equipa B</mat-checkbox>
              </section>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>


  <!-- Seção 2: Adversário e Competição (Em Grid, Similar a Seções de Atleta) -->
  <div class="modal-body p-4">
    <div class="card border-0 shadow-sm mb-4">
      <div class="card-header bg-success text-white">
        <h6 class="mb-0"><i class="nc-icon nc-single-02 me-2"></i>Adversário e Competição</h6>
      </div>
      <div class="card-body">
        <form>
          <div class="row">
            <!-- Equipa Adversária -->
            <div class="col-md-6 mb-3">
              <label for="equipaAdversaria" class="form-label fw-bold">
                <i class="nc-icon nc_users-1 me-1 text-success"></i>Equipa Adversária <span class="text-danger">*</span>
              </label>
              <select class="form-select form-select" id="equipaAdversaria" [(ngModel)]="novoJogo.equipa_adv_id"
                name="equipaAdversaria" (change)="onEquipaAdversariaChange(novoJogo.equipa_adv_id)" required>
                <option [ngValue]="0" disabled selected>Selecione uma equipa</option>
                <option *ngFor="let clube of clubes" [ngValue]="clube.id">
                  {{ clube.nome }}
                </option>
              </select>
            </div>

            <!-- Tipo Equipa Adv -->
            <div class="col-md-6 mb-3">
              <div class="form-check mt-2"> <!-- form-check para estrutura Bootstrap -->
                <section class="example-section">
                  <mat-checkbox [(ngModel)]="isEquipaB_adv">Equipa B</mat-checkbox>
                </section>
              </div>
            </div>
          </div>

          <div class="row">
            <!-- Competição -->
            <div class="col-md-12 mb-3">
              <label for="competicao" class="form-label fw-bold">
                <i class="nc-icon nc-trophy me-1 text-success"></i>Competição <span class="text-danger">*</span>
              </label>
              <select class="form-select form-select" id="competicao" [(ngModel)]="novoJogo.competicao_id"
                name="competicao" (change)="onCompeticaoChange(novoJogo.competicao_id)" required>
                <option [ngValue]="0" disabled selected>Selecione uma competição</option>
                <option *ngFor="let comp of competicoes" [ngValue]="comp.id">{{ comp.nome }}</option>
              </select>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
  <div class="modal-body p-4">
    <!-- Seção 1: Detalhes Básicos do Jogo (Em Grid de 2 Colunas, como em Ficha Atleta) -->
    <div class="card border-0 shadow-sm mb-4">
      <div class="card-header bg-primary text-white">
        <h6 class="mb-0"><i class="nc-icon nc-calendar-60 me-2"></i>Detalhes do Jogo</h6>
      </div>
      <div class="card-body">
        <form>
          <div class="row">
            <!-- Coluna Esquerda -->
            <div class="col-md-6 mb-3">
              <label for="dataJogo" class="form-label fw-bold">
                <i class="nc-icon nc-calendar-60 text-primary me-1"></i>Data do Jogo <span class="text-danger">*</span>
              </label>
              <input type="date" class="form-control form-control" id="dataJogo" [(ngModel)]="novoJogo.data"
                name="dataJogo" required [class.is-invalid]="novoJogo.data === null">
              <div class="invalid-feedback">Data é obrigatória.</div>
            </div>

            <!-- Coluna Direita -->
            <div class="col-md-6 mb-3">
              <label for="horaJogo" class="form-label fw-bold">
                <i class="nc-icon nc-time-alarm me-1 text-primary"></i>Hora do Jogo <span class="text-danger">*</span>
              </label>
              <input type="time" class="form-control form-control" id="horaJogo" [(ngModel)]="novoJogo.hora"
                name="horaJogo" required [class.is-invalid]="novoJogo.hora === ''">
              <div class="invalid-feedback">Hora é obrigatória.</div>
            </div>
          </div>

          <div class="row">
            <!-- Tipo Local -->
            <div class="col-md-6 mb-3">
              <label for="tipoLocal" class="form-label fw-bold">
                <i class="nc-icon nc-home-50 me-1 text-primary"></i>Tipo de Local
              </label>
              <select class="form-select form-select" id="tipoLocal" [(ngModel)]="novoJogo.tipo_local" name="tipoLocal"
                (change)="onTipoLocal()">
                <option value="Casa">Casa</option>
                <option value="Fora">Fora</option>
              </select>
            </div>
          </div>

          <div class="row">
            <!-- Local -->
            <div class="col-md-12 mb-3">
              <label for="localJogo" class="form-label fw-bold">
                <i class="nc-icon nc-pin-3 me-1 text-primary"></i>Local do Jogo <span class="text-danger">*</span>
              </label>
              <input type="text" class="form-control form-control" id="localJogo" [(ngModel)]="novoJogo.local"
                name="localJogo" placeholder="Ex: Pavilhão Municipal de Bragança" required>
            </div>
          </div>


        </form>
      </div>
    </div>


  </div>

  <div class="modal-footer bg-light border-top">

    <button type="button" class="btn btn-primary btn" (click)="modal.close('save')">
      <i class="nc-icon nc-check-2 me-2"></i>Salvar Jogo
    </button>
    <button type="button" class="btn btn-secondary btn" (click)="modal.dismiss('cancel')">
      <i class="nc-icon nc-simple-remove me-2"></i>Cancelar
    </button>
  </div>
</ng-template>
