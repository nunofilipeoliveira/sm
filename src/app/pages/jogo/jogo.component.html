<div class="game-summary">
  <div *ngIf="loading" class="loading-indicator">
    <p></p>
  </div>
  <div *ngIf="!loading">
    <!-- Scoreboard -->
    <div *ngIf="jogo.tipo_local=='C'" class="score-section">
      <div class="team-section">
        <img src="assets/img/clubes/clube_{{ meuClubeid }}.png"
          onerror="this.onerror=null; this.src='assets/img/clubes/default_clube.png'" alt="Nossa Equipa"
          class="team-logo" />
        <p class="team-name">{{nomeClube}} <span *ngIf="jogo.tipoEquipa==='B'">({{jogo.tipoEquipa}})</span></p>
      </div>

      <div class="score">
        <span class="score-home">{{jogo.golos_equipa}}</span>
        <span class="score-separator">-</span>
        <span class="score-away">{{jogo.golos_equipa_adv}}</span>
      </div>

      <div class="team-section">
        <img src="assets/img/clubes/clube_{{ jogo.equipa_adv_id }}.png"
          onerror="this.onerror=null; this.src='assets/img/clubes/default_clube.png'" alt="Advers√°rio"
          class="team-logo" />
        <p class="team-name">{{ jogo.equipa_adv_nome }} <span
            *ngIf="jogo.tipoEquipa_adv==='B'">({{jogo.tipoEquipa_adv}})</span></p>
      </div>
    </div>


    <div *ngIf="jogo.tipo_local=='F'" class="score-section">

      <div class="team-section">
        <img src="assets/img/clubes/clube_{{ jogo.equipa_adv_id }}.png"
          onerror="this.onerror=null; this.src='assets/img/clubes/default_clube.png'" alt="Advers√°rio"
          class="team-logo" />
        <p class="team-name">{{ jogo.equipa_adv_nome }} <span
            *ngIf="jogo.tipoEquipa_adv==='B'">({{jogo.tipoEquipa_adv}})</span></p>
      </div>

      <div class="score">
        <span class="score-home">{{jogo.golos_equipa_adv}}</span>
        <span class="score-separator">-</span>
        <span class="score-away">{{jogo.golos_equipa}}</span>
      </div>

      <div class="team-section">
        <img src="assets/img/clubes/clube_{{ meuClubeid }}.png"
          onerror="this.onerror=null; this.src='assets/img/clubes/default_clube.png'" alt="Nossa Equipa"
          class="team-logo" />
        <p class="team-name">{{nomeClube}} <span *ngIf="jogo.tipoEquipa==='B'">({{jogo.tipoEquipa}})</span></p>
      </div>


    </div>


    <!-- Game Info -->
    <div class="game-header">
      <p class="game-league"><img src="assets/img/competicoes/c_{{ jogo.competicao_id }}.png"
          onerror="this.onerror=null; this.src='assets/img/competicoes/default_competicao.png'" class="flag-icon" />
        {{jogo.competicao_nome}} <span *ngIf="jogo.numeroJogo"> (Jogo N¬∫:{{jogo.numeroJogo}} )</span></p>
      <p class="game-date">üìÖ {{jogo.data | date: 'fullDate'}} - {{jogo.hora}}</p>
      <p class="game-venue">üìç {{jogo.local}}</p>
    </div>

    <div *ngIf="jogo.estado==='INICIADO' && !mostrarRegisto" class="team-staff">
      <!-- colocar mensagem forte de jogo por registar -->
      <h2>O jogo est√° por registar a informa√ß√£o</h2>
    </div>

    <!-- Se√ß√£o de Registro de Informa√ß√µes do Jogo (Expand√≠vel por Jogador) -->
    <div *ngIf="mostrarRegisto" class="registo-container">
      <h3 class="titulo-registo">Registar Informa√ß√£o do Jogo</h3>

      <div *ngFor="let jogador of jogo.jogadores" class="jogador-item">
        <div class="jogador-header" (click)="toggleJogadorExpand(jogador.id_jogador)">
          <img src="assets/img/jogadores/{{jogador.id_jogador}}_avatar.jpg"
            onerror="this.onerror=null; this.src='assets/img/jogadores/default_avatar.jpg'"
            class="player-avatar me-2" />
          <span class="nome-jogador">{{ jogador.nome }}</span>
          <i class="nc-icon" [ngClass]="{'nc-minimal-down': !jogador.expanded, 'nc-minimal-up': jogador.expanded}"></i>
        </div>

        <div *ngIf="jogador.expanded" class="jogador-details">
          <div class="linha-info">
            <label for="capitao-{{jogador.id_jogador}}">Capit√£o</label>
            <input type="checkbox" [(ngModel)]="jogador.capitao" name="capitao-{{jogador.id_jogador}}"
              id="capitao-{{jogador.id_jogador}}" (change)="definirCapitao(jogador)" />
          </div>

          <div class="linha-info">
            <label>N¬∫ Camisola</label>
            <input type="number" [(ngModel)]="jogador.numero" name="numero-{{jogador.id_jogador}}" min="1" max="99"
              class="input-numero" />
          </div>

          <div class="linha-info">
            <label>GR</label>
            <input type="checkbox" [(ngModel)]="jogador.isGR" name="isGR-{{jogador.id_jogador}}"
              id="isGR-{{jogador.id_jogador}}" class="input-isGR" />
          </div>

          <hr class="separador" />

          <div class="eventos-jogador">
            <div *ngIf="!jogador.isGR" class="grupo-eventos">
              <h4>‚öΩ Golos Marcados</h4>
              <div class="controles">
                <ng-container *ngFor="let tipo of tiposGolo">
                  <div class="linha-controle">
                    <label>{{ tipo.label }}</label>
                    <button class="btn btn-sm btn-outline-danger" (click)="alterarGolo(jogador, tipo.key, true, -1)"
                      [disabled]="getGoloCount(jogador, tipo.key, true) === 0">‚àí</button>
                    <span class="contador">{{ getGoloCount(jogador, tipo.key, true) }}</span>
                    <button class="btn btn-sm btn-outline-success"
                      (click)="alterarGolo(jogador, tipo.key, true, 1)">+</button>
                  </div>
                </ng-container>
              </div>

            </div>

            <div *ngIf="jogador.isGR" class="grupo-eventos">
              <h4>ü•Ö Golos Sofridos</h4>
              <div class="controles">
                <ng-container *ngFor="let tipo of tiposGolo">
                  <div class="linha-controle">
                    <label>{{ tipo.label }}</label>
                    <button class="btn btn-sm btn-outline-danger" (click)="alterarGolo(jogador, tipo.key, false, -1)"
                      [disabled]="getGoloCount(jogador, tipo.key, false) === 0">‚àí</button>
                    <span class="contador">{{ getGoloCount(jogador, tipo.key, false) }}</span>
                    <button class="btn btn-sm btn-outline-success"
                      (click)="alterarGolo(jogador, tipo.key, false, 1)">+</button>
                  </div>
                </ng-container>
              </div>
            </div>

            <div class="grupo-eventos">
              <h4>üü®üü• Cart√µes</h4>
              <div class="controles">
                <ng-container *ngFor="let tipo of tiposCartao">
                  <div class="linha-controle">
                    <label>{{ tipo.label }}</label>
                    <button class="btn btn-sm btn-outline-danger" (click)="alterarCartao(jogador, tipo.key, -1)"
                      [disabled]="getCartaoCount(jogador, tipo.key) === 0">‚àí</button>
                    <span class="contador">{{ getCartaoCount(jogador, tipo.key) }}</span>
                    <button class="btn btn-sm btn-outline-success"
                      (click)="alterarCartao(jogador, tipo.key, 1)">+</button>
                  </div>
                </ng-container>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="text-center mt-3">
        <button class="btn btn-success btn-lg" (click)="salvarRegisto()">
          <i class="fas fa-save me-2"></i>Salvar Registo
        </button>
      </div>
    </div>

    <!-- Players -->
    <div *ngIf="jogo.estado==='CONCLUIDO' && !mostrarRegisto" class="team-staff">
      <h2>üë• Jogadores</h2>
      <ul>
        <li *ngFor="let jogador of jogo.jogadores">
          <span class="badge">{{jogador.numero}}</span>
          <span class="staff-name"><img src="assets/img/jogadores/{{jogador.id_jogador}}_avatar.jpg"
              onerror="this.onerror=null; this.src='assets/img/jogadores/default_avatar.jpg'"
              class="player-avatar">{{jogador.nome}}</span>
          <span class="staff-cards">
            <!-- Cart√µes -->
            <span *ngIf="jogador.amarelo > 0">
              <ng-container *ngFor="let _ of [].constructor(jogador.amarelo)">üü®</ng-container>
            </span>
            <span *ngIf="jogador.azul > 0">
              <ng-container *ngFor="let _ of [].constructor(jogador.azul)">üü¶</ng-container>
            </span>
            <span *ngIf="jogador.vermelho > 0">
              <ng-container *ngFor="let _ of [].constructor(jogador.vermelho)">üü•</ng-container>
            </span>
            <!-- Golos Marcados -->
            <span *ngIf="jogador.golos_normal > 0">
              <ng-container *ngFor="let _ of [].constructor(jogador.golos_normal)"><img src="assets/img/jogo/GOLO.png" class="item-goal"></ng-container>
            </span>
            <span *ngIf="jogador.golos_p > 0">
              <ng-container *ngFor="let _ of [].constructor(jogador.golos_p)"><img src="assets/img/jogo/P.png" class="item-goal"></ng-container>
            </span>
            <span *ngIf="jogador.golos_pp > 0">
              <ng-container *ngFor="let _ of [].constructor(jogador.golos_pp)"><img src="assets/img/jogo/PP.png" class="item-goal"></ng-container>
            </span>
            <span *ngIf="jogador.golos_up > 0">
              <ng-container *ngFor="let _ of [].constructor(jogador.golos_up)"><img src="assets/img/jogo/UP.png" class="item-goal"></ng-container>
            </span>
            <span *ngIf="jogador.golos_ld > 0">
              <ng-container *ngFor="let _ of [].constructor(jogador.golos_ld)"><img src="assets/img/jogo/LD.png" class="item-goal"></ng-container>
            </span>
            <!-- Golos Sofridos -->
            <span *ngIf="jogador.golos_s_normal > 0">
              <ng-container *ngFor="let _ of [].constructor(jogador.golos_s_normal)"><img src="assets/img/jogo/GOLO_S.png" class="item-goal"></ng-container>
            </span>
            <span *ngIf="jogador.golos_s_p > 0">
              <ng-container *ngFor="let _ of [].constructor(jogador.golos_s_p)"><img src="assets/img/jogo/P_S.png" class="item-goal"></ng-container>
            </span>
            <span *ngIf="jogador.golos_s_pp > 0">
              <ng-container *ngFor="let _ of [].constructor(jogador.golos_s_pp)"><img src="assets/img/jogo/PP_S.png" class="item-goal"></ng-container>
            </span>
            <span *ngIf="jogador.golos_s_up > 0">
              <ng-container *ngFor="let _ of [].constructor(jogador.golos_s_up)"><img src="assets/img/jogo/UP_S.png" class="item-goal"></ng-container>
            </span>
            <span *ngIf="jogador.golos_s_ld > 0">
              <ng-container *ngFor="let _ of [].constructor(jogador.golos_s_ld)"><img src="assets/img/jogo/LD_S.png" class="item-goal"></ng-container>
            </span>
          </span>
        </li>

        <div class="legenda-golos">
          <span><img src="assets/img/jogo/GOLO.png" class="item-goal"> Golo</span>
          <span><img src="assets/img/jogo/P.png" class="item-goal"> Penalty</span>
          <span><img src="assets/img/jogo/LD.png" class="item-goal"> Livre Direto</span>
          <span><img src="assets/img/jogo/PP.png" class="item-goal"> Golo em PowerPlay</span>
          <span><img src="assets/img/jogo/UP.png" class="item-goal"> Golo em UnderPlay</span>
        </div>


      </ul>
    </div>

    <div class="d-flex justify-content-between ">
      <button type="button" class="btn btn-secondary btn-lg" (click)="voltar()">
        <i class="nc-icon nc-minimal-left me-2"></i> Voltar
      </button>
      <button type="button" *ngIf="jogo.estado==='INICIADO' && !mostrarRegisto" class="btn btn-warning btn-lg"
        (click)="registarInformacaoJogo()">
        <i class="nc-icon nc-ruler-pencil me-2"></i> Registar Informa√ß√£o do Jogo
      </button>
      <button type="button" *ngIf="jogo.estado==='CONCLUIDO' && !mostrarRegisto" class="btn btn-warning btn-lg"
        (click)="editarJogo()">
        <i class="nc-icon nc-ruler-pencil me-2"></i> Editar
      </button>
      <button class="btn btn-info btn-lg" (click)="verConvocatoria(jogo.id)">
        <i class="nc-icon nc-bullet-list-67 me-2"></i>Convocat√≥ria
      </button>
    </div>
  </div>
</div>